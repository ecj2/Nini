"use strict";let Momo=new class{constructor(){this.main_canvas=void 0,this.target_canvas=void 0,this.frame_rate=void 0,this.key=[],this.key_codes=this.defineKeyCodes(),this.key_pressed=[],this.key_released=[],this.mouse_x=0,this.mouse_y=0,this.mouse_z=0,this.mouse_button=[],this.mouse_buttons=this.defineMouseButtons(),this.mouse_button_pressed=[],this.mouse_button_released=[],this.mouse_focused=!1,this.time_initialized=void 0,this.sample_instances=[],this.back_buffer=void 0,this.game_loop_procedure=void 0,this.game_loop_interval_identifier=void 0,this.mouse_method=this.manageMouseEvents.bind(this),this.keyboard_method=this.manageKeyboardEvents.bind(this)}initialize(){let a=document.createElement("canvas");return!!!!(a&&a.getContext("2d"))&&(this.time_initialized=Date.now(),!0)}getTime(){return(Date.now()-this.time_initialized)/1e3}manageMouseEvents(a){switch(a.type){case"wheel":this.mouse_z=a.deltaY;break;case"mouseup":this.mouse_button[a.button]=!1,this.mouse_button_released[a.button]=!0;break;case"mouseout":this.mouse_focused=!1;break;case"mouseover":this.mouse_focused=!0;break;case"mousedown":this.mouse_button[a.button]||(this.mouse_button_pressed[a.button]=!0),this.mouse_button[a.button]=!0;break;case"mousemove":this.isMouseLocked()?(this.mouse_x+=a.movementX,this.mouse_y+=a.movementY):(this.mouse_x=a.offsetX,this.mouse_y=a.offsetY);}("wheel"===a.type||3===a.which)&&a.preventDefault()}defineKeyCodes(){return{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pausebreak:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,lmeta:91,rmeta:92,select:93,pad_0:96,pad_1:97,pad_2:98,pad_3:99,pad_4:100,pad_5:101,pad_6:102,pad_7:103,pad_8:104,pad_9:105,multiply:106,add:107,subtract:109,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equals:187,comma:188,dash:189,period:190,forwardslash:191,tilde:192,openbrace:219,backslash:220,closebrace:221,quote:222}}defineMouseButtons(){return{left:0,middle:1,right:2}}installMouse(){this.main_canvas.canvas.addEventListener("wheel",this.mouse_method),this.main_canvas.canvas.addEventListener("mouseup",this.mouse_method),this.main_canvas.canvas.addEventListener("mouseout",this.mouse_method),this.main_canvas.canvas.addEventListener("mouseover",this.mouse_method),this.main_canvas.canvas.addEventListener("mousedown",this.mouse_method),this.main_canvas.canvas.addEventListener("mousemove",this.mouse_method),this.main_canvas.canvas.addEventListener("contextmenu",this.mouse_method)}uninstallMouse(){this.main_canvas.canvas.removeEventListener("wheel",this.mouse_method),this.main_canvas.canvas.removeEventListener("mouseup",this.mouse_method),this.main_canvas.canvas.removeEventListener("mouseout",this.mouse_method),this.main_canvas.canvas.removeEventListener("mouseover",this.mouse_method),this.main_canvas.canvas.removeEventListener("mousedown",this.mouse_method),this.main_canvas.canvas.removeEventListener("mousemove",this.mouse_method),this.main_canvas.canvas.removeEventListener("contextmenu",this.mouse_method)}isMouseFocused(){return this.mouse_focused}isMouseButtonUp(a){if("any"===a){let a=0;for(a;3>a;++a)if(!this.mouse_button[a])return!0;return!1}return!this.mouse_button[this.mouse_buttons[a]]}isMouseButtonDown(a){if("any"===a){let a=0;for(a;3>a;++a)if(this.mouse_button[a])return!0;return!1}return this.mouse_button[this.mouse_buttons[a]]}isMouseButtonPressed(a){if("any"===a){let a=0;for(a;3>a;++a)if(this.mouse_button_pressed[a])return!0;return!1}return this.mouse_button_pressed[this.mouse_buttons[a]]}isMouseButtonReleased(a){if("any"===a){let a=0;for(a;3>a;++a)if(this.mouse_button_released[a])return!0;return!1}return this.mouse_button_released[this.mouse_buttons[a]]}getMouseX(){return this.mouse_x}getMouseY(){return this.mouse_y}getMouseZ(){return this.mouse_z}hideMouseCursor(){this.main_canvas.canvas.style.cursor="none"}showMouseCursor(){this.main_canvas.canvas.style.cursor="auto"}isMouseCursorHidden(){return"none"===this.main_canvas.canvas.style.cursor}lockMouse(){this.main_canvas.canvas.requestPointerLock()}unlockMouse(){this.isMouseLocked()&&document.exitPointerLock()}isMouseLocked(){return document.pointerLockElement===this.getCanvas()}manageKeyboardEvents(a){switch(a.type){case"keyup":this.key[a.which]=!1,this.key_released[a.which]=!0;break;case"keydown":this.key[a.which]||(this.key_pressed[a.which]=!0),this.key[a.which]=!0;}a.preventDefault()}installKeyboard(){document.addEventListener("keyup",this.keyboard_method),document.addEventListener("keydown",this.keyboard_method)}uninstallKeyboard(){document.removeEventListener("keyup",this.keyboard_method),document.removeEventListener("keydown",this.keyboard_method)}isKeyUp(a){if("any"===a){if(0===this.key.length)return!0;let a=0,b=this.key.length;for(a;a<b;++a)if(!this.key[a])return!0;return!1}return!this.key[this.key_codes[a]]}isKeyDown(a){if("any"===a){let a=0,b=this.key.length;for(a;a<b;++a)if(this.key[a])return!0;return!1}return this.key[this.key_codes[a]]}isKeyPressed(a){if("any"===a){let a=0,b=this.key_pressed.length;for(a;a<b;++a)if(this.key_pressed[a])return!0;return!1}return this.key_pressed[this.key_codes[a]]}isKeyReleased(a){if("any"===a){let a=0,b=this.key_released.length;for(a;a<b;++a)if(this.key_released[a])return!0;return!1}return this.key_released[this.key_codes[a]]}setCanvas(a,b,c){let d=document.getElementById(a);return!!!!d&&(d.width=b,d.height=c,this.main_canvas={width:b,height:c,canvas:d,context:d.getContext("2d")},this.setTargetCanvas(this.getCanvas()),this.back_buffer=this.createBitmap(b,c),!0)}getCanvas(){return this.main_canvas.canvas}getCanvasContext(){return this.main_canvas.context}getBackBuffer(){return this.back_buffer.context.drawImage(this.main_canvas.canvas,0,0),this.back_buffer}clearCanvas(a){this.setStrokeAndFillStyle(a),this.target_canvas.context.fillRect(0,0,this.target_canvas.width,this.target_canvas.height)}resizeCanvas(a,b){this.setCanvasWidth(a),this.setCanvasHeight(b)}setCanvasWidth(a){this.main_canvas.width=a,this.main_canvas.canvas.width=a,this.getTargetCanvas()===this.getCanvas()&&(this.target_canvas.width=a,this.target_canvas.canvas.width=a),this.back_buffer=this.createBitmap(a,this.getBitmapHeight(this.back_buffer))}setCanvasHeight(a){this.main_canvas.height=a,this.main_canvas.canvas.height=a,this.getTargetCanvas()===this.getCanvas()&&(this.target_canvas.height=a,this.target_canvas.canvas.height=a),this.back_buffer=this.createBitmap(this.getBitmapWidth(this.back_buffer),a)}getCanvasWidth(){return this.main_canvas.width}getCanvasHeight(){return this.main_canvas.height}setTargetCanvas(a){this.target_canvas={width:a.width,height:a.height,canvas:a,context:a.getContext("2d")}}getTargetCanvas(){return this.target_canvas.canvas}getTargetCanvasContext(){return this.target_canvas.context}getTargetCanvasWidth(){return this.target_canvas.width}getTargetCanvasHeight(){return this.target_canvas.height}scaleCanvas(a,b){this.target_canvas.context.scale(a,b)}rotateCanvas(a){this.target_canvas.context.rotate(a)}translateCanvas(a,b){this.target_canvas.context.translate(a,b)}saveCanvasState(){this.target_canvas.context.save()}restoreCanvasState(){this.target_canvas.context.restore()}setFrameRate(a){this.frame_rate=a,this.game_loop_interval_identifier!==void 0&&(clearInterval(this.game_loop_interval_identifier),this.createLoop(this.game_loop_procedure))}getFrameRate(){return this.frame_rate}createLoop(a){this.game_loop_procedure=a,this.game_loop_interval_identifier=setInterval((()=>{if(!document.hidden){a();let b=0;for(b;3>b;++b)this.mouse_button_pressed[b]=!1,this.mouse_button_released[b]=!1;for(b=0,length=this.key.length,b;b<length;++b)this.key_pressed[b]=!1,this.key_released[b]=!1}}).bind(this),1e3/this.frame_rate)}makeColor(c,d,e,b=255){return{r:c,g:d,b:e,a:b}}setStrokeAndFillStyle(c,d=0){let e=c.r,f=c.g,g=c.b,b=c.a/255;this.target_canvas.context.lineWidth=d,this.target_canvas.context.fillStyle="rgba("+e+", "+f+", "+g+", "+b+")",this.target_canvas.context.strokeStyle="rgba("+e+", "+f+", "+g+", "+b+")"}setEntryPoint(a){addEventListener("load",a)}setBlendMode(a){this.target_canvas.context.globalCompositeOperation=a}loadFont(a,b="normal"){return fetch(a).then(c=>{if(200===c.status){let c=document.createElement("style"),d="font_"+Math.random().toString(16).slice(2);return c.textContent=`@font-face {font-family: "`+d+`";src: url("`+a+`");}`,document.head.appendChild(c),this.loadFontFace(d,b)}return!1})}loadFontFace(a,b="normal"){let c={name:a,style:b};return this.drawText(c,this.makeColor(0,0,0,0),0,0,0,"left",""),c}drawText(a,b,c,d,e,f,g,h=void 0,i=0){this.target_canvas.context.textAlign=f,this.target_canvas.context.font=a.style+" "+c+"px "+a.name,this.setStrokeAndFillStyle(b),this.target_canvas.context.fillText(g,d,e+c),h!==void 0&&0<i&&(this.setStrokeAndFillStyle(h,i),this.target_canvas.context.strokeText(g,d,e+c))}loadSample(a){let b=document.createElement("audio");if(!!!b.canPlayType("audio/"+a.split(".").pop()))return!1;b.src=a;let c,d;return new Promise((a,e)=>{d=()=>{a({element:b})},c=()=>{e(!1)},b.addEventListener("error",c),b.addEventListener("canplaythrough",d)}).then(a=>(b.removeEventListener("error",c),b.removeEventListener("canplaythrough",d),a),a=>(b.removeEventListener("error",c),b.removeEventListener("canplaythrough",d),a))}playSample(a,b,c,d,e){this.sample_instances[e]===void 0&&(this.sample_instances[e]=a.element.cloneNode()),this.isSamplePlaying(e)||(this.adjustSample(e,b,c,d),this.sample_instances[e].play())}adjustSample(a,b,c,d){this.sample_instances[a]!==void 0&&(this.sample_instances[a].loop=d,this.sample_instances[a].volume=b,this.sample_instances[a].playbackRate=c)}stopSample(a){this.sample_instances[a]!==void 0&&this.isSamplePlaying(a)&&(this.pauseSample(a),this.sample_instances[a].currentTime=0)}pauseSample(a){this.sample_instances[a]!==void 0&&this.isSamplePlaying(a)&&this.sample_instances[a].pause()}resumeSample(a){this.sample_instances[a]!==void 0&&this.sample_instances[a].play()}isSamplePaused(a){return void 0!==this.sample_instances[a]&&this.sample_instances[a].paused}isSamplePlaying(a){return void 0!==this.sample_instances[a]&&!this.isSamplePaused(a)&&!!(this.sample_instances[a].currentTime<this.sample_instances[a].duration)}getSampleProperties(a){let b=this.sample_instances[a];return void 0===b?void 0:{loop:b.loop,speed:b.playbackRate,volume:b.volume}}loadBitmap(a){let b=new Image;b.src=a;let c,d;return new Promise((a,e)=>{d=()=>{let c=document.createElement("canvas"),d=c.getContext("2d"),e={canvas:c,context:d,width:0,height:0};e.canvas.width=b.width,e.canvas.height=b.height,e.context.drawImage(b,0,0),e.width=b.width,e.height=b.height,a(e)},c=()=>{e(!1)},b.addEventListener("load",d),b.addEventListener("error",c)}).then(a=>(b.removeEventListener("load",d),b.removeEventListener("error",c),a),a=>(b.removeEventListener("load",d),b.removeEventListener("error",c),a))}getBitmapWidth(a){return a.width}getBitmapHeight(a){return a.height}getBitmapCanvas(a){return a.canvas}getBitmapCanvasContext(a){return a.context}drawBitmap(a,b,c){this.target_canvas.context.drawImage(a.canvas,b,c)}drawScaledBitmap(a,b,c,d,e,f,g){b=0>b?0:b,b=b>a.width?a.width:b,c=0>c?0:c,c=c>a.height?a.height:c,this.saveCanvasState(),this.translateCanvas(f,g),this.scaleCanvas(d,e),this.drawBitmap(a,-b,-c),this.restoreCanvasState()}drawTintedBitmap(a,b,c,d){this.drawBitmap(this.createTintedBitmap(a,b),c,d)}drawClippedBitmap(a,b,c,d,e,f,g){this.target_canvas.context.drawImage(a.canvas,b,c,d,e,f,g,d,e)}drawRotatedBitmap(a,b,c,d,e,f){this.saveCanvasState(),this.translateCanvas(d+b,e+c),this.rotateCanvas(f),this.drawBitmap(a,-b,-c),this.restoreCanvasState()}createBitmap(a,b){let c=document.createElement("canvas");c.width=a,c.height=b;let d=c.getContext("2d");return{canvas:c,context:d,width:a,height:b}}createTintedBitmap(a,b){let c=this.createBitmap(a.width,a.height),d=c.context,e=this.getTargetCanvas();return this.setTargetCanvas(c.canvas),this.drawBitmap(a,0,0),this.setBlendMode("multiply"),this.drawFilledRectangle(0,0,c.width,c.height,b),this.setBlendMode("destination-atop"),this.drawBitmap(a,0,0),this.setTargetCanvas(e),c}createClippedBitmap(a,b,c,d,e){let f=a.context.getImageData(b,c,d,e),g=document.createElement("canvas"),h=g.getContext("2d");return g.width=d,g.height=e,h.putImageData(f,0,0),{canvas:g,context:h,width:d,height:e}}drawPolyline(a,b,c){this.setStrokeAndFillStyle(b,c);let d=[],e=[],f=0,g=a.length;for(f;f<g;++f)f%2?e.push(a[f]):d.push(a[f]);for(this.target_canvas.context.beginPath(),f=0,g=d.length,f;f<g;++f){if(0===f){this.target_canvas.context.moveTo(d[f],e[f]);continue}this.target_canvas.context.lineTo(d[f],e[f])}this.target_canvas.context.stroke()}drawPolygon(a,b,c){this.setStrokeAndFillStyle(b,c);let d=[],e=[],f=0,g=a.length;for(f;f<g;++f)f%2?e.push(a[f]):d.push(a[f]);for(this.target_canvas.context.beginPath(),f=0,g=d.length,f;f<g;++f){if(0===f){this.target_canvas.context.moveTo(d[f],e[f]);continue}this.target_canvas.context.lineTo(d[f],e[f])}this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledPolygon(a,b){this.setStrokeAndFillStyle(b);let c=[],d=[],e=0,f=a.length;for(e;e<f;++e)e%2?d.push(a[e]):c.push(a[e]);for(this.target_canvas.context.beginPath(),e=0,f=c.length,e;e<f;++e){if(0===e){this.target_canvas.context.moveTo(c[e],d[e]);continue}this.target_canvas.context.lineTo(c[e],d[e])}this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawLine(a,b,c,d,e,f){this.drawPolyline([a,b,c,d],e,f)}drawPixel(a,b,c){this.drawFilledRectangle(a,b,a+1,b+1,c)}drawArc(a,b,c,d,e,f,g){this.setStrokeAndFillStyle(f,g),this.target_canvas.context.beginPath(),this.target_canvas.context.arc(a,b,c,d,e),this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledArc(a,b,c,d,e,f){this.setStrokeAndFillStyle(f),this.target_canvas.context.beginPath(),this.target_canvas.context.arc(a,b,c,d,e),this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawCircle(a,b,c,d,e){this.drawArc(a,b,c,0,2*Math.PI,d,e)}drawFilledCircle(a,b,c,d){this.drawFilledArc(a,b,c,0,2*Math.PI,d)}drawEllipse(a,b,c,d,e,f){this.setStrokeAndFillStyle(e,f),this.target_canvas.context.beginPath(),this.target_canvas.context.ellipse(a,b,c,d,0,0,2*Math.PI),this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledEllipse(a,b,c,d,e){this.setStrokeAndFillStyle(e),this.target_canvas.context.beginPath(),this.target_canvas.context.ellipse(a,b,c,d,0,0,2*Math.PI),this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawRectangle(a,b,c,d,e,f){this.setStrokeAndFillStyle(e,f),this.target_canvas.context.beginPath(),this.target_canvas.context.rect(a,b,c-a,d-b),this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledRectangle(a,b,c,d,e){this.setStrokeAndFillStyle(e),this.target_canvas.context.beginPath(),this.target_canvas.context.rect(a,b,c-a,d-b),this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawTriangle(a,b,c,d,e,f,g,h){this.drawPolygon([a,b,c,d,e,f],g,h)}drawFilledTriangle(a,b,c,d,e,f,g){this.drawFilledPolygon([a,b,c,d,e,f],g)}};
