"use strict";let Momo=new class{constructor(){this.main_canvas=void 0,this.target_canvas=void 0,this.frame_rate=void 0,this.key=[],this.key_codes=this.defineKeyCodes(),this.key_pressed=[],this.key_released=[],this.mouse_x=0,this.mouse_y=0,this.mouse_z=0,this.mouse_button=[],this.mouse_buttons=this.defineMouseButtons(),this.mouse_button_pressed=[],this.mouse_button_released=[],this.mouse_focused=!1,this.time_initialized=void 0,this.sample_instances=[],this.back_buffer=void 0,this.game_loop_procedure=void 0,this.game_loop_interval_identifier=void 0,this.mouse_method=this.manageMouseEvents.bind(this),this.keyboard_method=this.manageKeyboardEvents.bind(this)}initialize(){let c=document.createElement("canvas");return!!!!(c&&c.getContext("2d"))&&(this.time_initialized=Date.now(),!0)}getTime(){return(Date.now()-this.time_initialized)/1e3}manageMouseEvents(c){switch(c.type){case"wheel":this.mouse_z=c.deltaY;break;case"mouseup":this.mouse_button[c.button]=!1,this.mouse_button_released[c.button]=!0;break;case"mouseout":this.mouse_focused=!1;break;case"mouseover":this.mouse_focused=!0;break;case"mousedown":this.mouse_button[c.button]||(this.mouse_button_pressed[c.button]=!0),this.mouse_button[c.button]=!0;break;case"mousemove":this.isMouseLocked()?(this.mouse_x+=c.movementX,this.mouse_y+=c.movementY):(this.mouse_x=c.offsetX,this.mouse_y=c.offsetY);}("wheel"===c.type||3===c.which)&&c.preventDefault()}defineKeyCodes(){return{0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pausebreak:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,lmeta:91,rmeta:92,select:93,pad_0:96,pad_1:97,pad_2:98,pad_3:99,pad_4:100,pad_5:101,pad_6:102,pad_7:103,pad_8:104,pad_9:105,multiply:106,add:107,subtract:109,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equals:187,comma:188,dash:189,period:190,forwardslash:191,tilde:192,openbrace:219,backslash:220,closebrace:221,quote:222}}defineMouseButtons(){return{left:0,middle:1,right:2}}installMouse(){this.main_canvas.canvas.addEventListener("wheel",this.mouse_method),this.main_canvas.canvas.addEventListener("mouseup",this.mouse_method),this.main_canvas.canvas.addEventListener("mouseout",this.mouse_method),this.main_canvas.canvas.addEventListener("mouseover",this.mouse_method),this.main_canvas.canvas.addEventListener("mousedown",this.mouse_method),this.main_canvas.canvas.addEventListener("mousemove",this.mouse_method),this.main_canvas.canvas.addEventListener("contextmenu",this.mouse_method)}uninstallMouse(){this.main_canvas.canvas.removeEventListener("wheel",this.mouse_method),this.main_canvas.canvas.removeEventListener("mouseup",this.mouse_method),this.main_canvas.canvas.removeEventListener("mouseout",this.mouse_method),this.main_canvas.canvas.removeEventListener("mouseover",this.mouse_method),this.main_canvas.canvas.removeEventListener("mousedown",this.mouse_method),this.main_canvas.canvas.removeEventListener("mousemove",this.mouse_method),this.main_canvas.canvas.removeEventListener("contextmenu",this.mouse_method)}isMouseFocused(){return this.mouse_focused}isMouseButtonUp(c){if("any"===c){let d=0;for(d;3>d;++d)if(!this.mouse_button[d])return!0;return!1}return!this.mouse_button[this.mouse_buttons[c]]}isMouseButtonDown(c){if("any"===c){let d=0;for(d;3>d;++d)if(this.mouse_button[d])return!0;return!1}return this.mouse_button[this.mouse_buttons[c]]}isMouseButtonPressed(c){if("any"===c){let d=0;for(d;3>d;++d)if(this.mouse_button_pressed[d])return!0;return!1}return this.mouse_button_pressed[this.mouse_buttons[c]]}isMouseButtonReleased(c){if("any"===c){let d=0;for(d;3>d;++d)if(this.mouse_button_released[d])return!0;return!1}return this.mouse_button_released[this.mouse_buttons[c]]}getMouseX(){return this.mouse_x}getMouseY(){return this.mouse_y}getMouseZ(){return this.mouse_z}hideMouseCursor(){this.main_canvas.canvas.style.cursor="none"}showMouseCursor(){this.main_canvas.canvas.style.cursor="auto"}isMouseCursorHidden(){return"none"===this.main_canvas.canvas.style.cursor}lockMouse(){this.main_canvas.canvas.requestPointerLock()}unlockMouse(){this.isMouseLocked()&&document.exitPointerLock()}isMouseLocked(){return document.pointerLockElement===this.getCanvas()}manageKeyboardEvents(c){switch(c.type){case"keyup":this.key[c.which]=!1,this.key_released[c.which]=!0;break;case"keydown":this.key[c.which]||(this.key_pressed[c.which]=!0),this.key[c.which]=!0;}c.preventDefault()}installKeyboard(){document.addEventListener("keyup",this.keyboard_method),document.addEventListener("keydown",this.keyboard_method)}uninstallKeyboard(){document.removeEventListener("keyup",this.keyboard_method),document.removeEventListener("keydown",this.keyboard_method)}isKeyUp(c){if("any"===c){if(0===this.key.length)return!0;let d=0,e=this.key.length;for(d;d<e;++d)if(!this.key[d])return!0;return!1}return!this.key[this.key_codes[c]]}isKeyDown(c){if("any"===c){let d=0,e=this.key.length;for(d;d<e;++d)if(this.key[d])return!0;return!1}return this.key[this.key_codes[c]]}isKeyPressed(c){if("any"===c){let d=0,e=this.key_pressed.length;for(d;d<e;++d)if(this.key_pressed[d])return!0;return!1}return this.key_pressed[this.key_codes[c]]}isKeyReleased(c){if("any"===c){let d=0,e=this.key_released.length;for(d;d<e;++d)if(this.key_released[d])return!0;return!1}return this.key_released[this.key_codes[c]]}setCanvas(c,d,e){let f=document.getElementById(c);return!!!!f&&(f.width=d,f.height=e,this.main_canvas={width:d,height:e,canvas:f,context:f.getContext("2d")},this.setTargetCanvas(this.getCanvas()),this.back_buffer=this.createBitmap(d,e),!0)}getCanvas(){return this.main_canvas.canvas}getCanvasContext(){return this.main_canvas.context}getBackBuffer(){return this.back_buffer.context.drawImage(this.main_canvas.canvas,0,0),this.back_buffer}clearCanvas(c){this.setStrokeAndFillStyle(c),this.target_canvas.context.fillRect(0,0,this.target_canvas.width,this.target_canvas.height)}resizeCanvas(c,d){this.setCanvasWidth(c),this.setCanvasHeight(d)}setCanvasWidth(c){this.main_canvas.width=c,this.main_canvas.canvas.width=c,this.getTargetCanvas()===this.getCanvas()&&(this.target_canvas.width=c,this.target_canvas.canvas.width=c),this.back_buffer=this.createBitmap(c,this.getBitmapHeight(this.back_buffer))}setCanvasHeight(c){this.main_canvas.height=c,this.main_canvas.canvas.height=c,this.getTargetCanvas()===this.getCanvas()&&(this.target_canvas.height=c,this.target_canvas.canvas.height=c),this.back_buffer=this.createBitmap(this.getBitmapWidth(this.back_buffer),c)}getCanvasWidth(){return this.main_canvas.width}getCanvasHeight(){return this.main_canvas.height}setTargetCanvas(c){this.target_canvas={width:c.width,height:c.height,canvas:c,context:c.getContext("2d")}}getTargetCanvas(){return this.target_canvas.canvas}getTargetCanvasContext(){return this.target_canvas.context}getTargetCanvasWidth(){return this.target_canvas.width}getTargetCanvasHeight(){return this.target_canvas.height}scaleCanvas(c,d){this.target_canvas.context.scale(c,d)}rotateCanvas(c){this.target_canvas.context.rotate(c)}translateCanvas(c,d){this.target_canvas.context.translate(c,d)}saveCanvasState(){this.target_canvas.context.save()}restoreCanvasState(){this.target_canvas.context.restore()}setFrameRate(c){this.frame_rate=c,this.game_loop_interval_identifier!==void 0&&(clearInterval(this.game_loop_interval_identifier),this.createLoop(this.game_loop_procedure))}getFrameRate(){return this.frame_rate}createLoop(c){this.game_loop_procedure=c,this.game_loop_interval_identifier=setInterval((()=>{if(!document.hidden){c();let d=0;for(d;3>d;++d)this.mouse_button_pressed[d]=!1,this.mouse_button_released[d]=!1;for(d=0,length=this.key.length,d;d<length;++d)this.key_pressed[d]=!1,this.key_released[d]=!1}}).bind(this),1e3/this.frame_rate)}makeColor(c,d,e,f=255){return{r:c,g:d,b:e,a:f}}setStrokeAndFillStyle(c,d=0){let e=c.r,f=c.g,h=c.b,j=c.a/255;this.target_canvas.context.lineWidth=d,this.target_canvas.context.fillStyle="rgba("+e+", "+f+", "+h+", "+j+")",this.target_canvas.context.strokeStyle="rgba("+e+", "+f+", "+h+", "+j+")"}setEntryPoint(c){addEventListener("load",c)}setBlendMode(c){this.target_canvas.context.globalCompositeOperation=c}loadFont(c,d="normal"){return fetch(c).then(e=>{if(200===e.status){let f=document.createElement("style"),h="font_"+Math.random().toString(16).slice(2);return f.textContent=`@font-face {font-family: "`+h+`";src: url("`+c+`");}`,document.head.appendChild(f),this.loadFontFace(h,d)}return!1})}loadFontFace(c,d="normal"){let e={name:c,style:d};return this.drawText(e,this.makeColor(0,0,0,0),0,0,0,"left",""),e}drawText(c,d,e,f,h,j,k,l=void 0,m=0){this.target_canvas.context.textAlign=j,this.target_canvas.context.font=c.style+" "+e+"px "+c.name,this.setStrokeAndFillStyle(d),this.target_canvas.context.fillText(k,f,h+e),l!==void 0&&0<m&&(this.setStrokeAndFillStyle(l,m),this.target_canvas.context.strokeText(k,f,h+e))}loadSample(c){let d=document.createElement("audio");if(!!!d.canPlayType("audio/"+c.split(".").pop()))return!1;d.src=c;let e,f;return new Promise((h,j)=>{f=()=>{h({element:d})},e=()=>{j(!1)},d.addEventListener("error",e),d.addEventListener("canplaythrough",f)}).then(h=>{return d.removeEventListener("error",e),d.removeEventListener("canplaythrough",f),h},h=>{return d.removeEventListener("error",e),d.removeEventListener("canplaythrough",f),h})}playSample(c,d,e,f,h){this.sample_instances[h]===void 0&&(this.sample_instances[h]=c.element.cloneNode()),this.isSamplePlaying(h)||(this.adjustSample(h,d,e,f),this.sample_instances[h].play())}adjustSample(c,d,e,f){this.sample_instances[c]!==void 0&&(this.sample_instances[c].loop=f,this.sample_instances[c].volume=d,this.sample_instances[c].playbackRate=e)}stopSample(c){this.sample_instances[c]!==void 0&&this.isSamplePlaying(c)&&(this.pauseSample(c),this.sample_instances[c].currentTime=0)}pauseSample(c){this.sample_instances[c]!==void 0&&this.isSamplePlaying(c)&&this.sample_instances[c].pause()}resumeSample(c){this.sample_instances[c]!==void 0&&this.sample_instances[c].play()}isSamplePaused(c){return void 0!==this.sample_instances[c]&&this.sample_instances[c].paused}isSamplePlaying(c){return void 0!==this.sample_instances[c]&&!this.isSamplePaused(c)&&!!(this.sample_instances[c].currentTime<this.sample_instances[c].duration)}loadBitmap(c){let d=new Image;d.src=c;let e,f;return new Promise((h,j)=>{f=()=>{let k=document.createElement("canvas"),l=k.getContext("2d"),m={canvas:k,context:l,width:0,height:0};m.canvas.width=d.width,m.canvas.height=d.height,m.context.drawImage(d,0,0),m.width=d.width,m.height=d.height,h(m)},e=()=>{j(!1)},d.addEventListener("load",f),d.addEventListener("error",e)}).then(h=>{return d.removeEventListener("load",f),d.removeEventListener("error",e),h},h=>{return d.removeEventListener("load",f),d.removeEventListener("error",e),h})}getBitmapWidth(c){return c.width}getBitmapHeight(c){return c.height}getBitmapCanvas(c){return c.canvas}getBitmapCanvasContext(c){return c.context}drawBitmap(c,d,e){this.target_canvas.context.drawImage(c.canvas,d,e)}drawScaledBitmap(c,d,e,f,h,j,k){d=0>d?0:d,d=d>c.width?c.width:d,e=0>e?0:e,e=e>c.height?c.height:e,this.saveCanvasState(),this.translateCanvas(j,k),this.scaleCanvas(f,h),this.drawBitmap(c,-d,-e),this.restoreCanvasState()}drawTintedBitmap(c,d,e,f){this.drawBitmap(this.createTintedBitmap(c,d),e,f)}drawClippedBitmap(c,d,e,f,h,j,k){this.target_canvas.context.drawImage(c.canvas,d,e,f,h,j,k,f,h)}drawRotatedBitmap(c,d,e,f,h,j){this.saveCanvasState(),this.translateCanvas(f+d,h+e),this.rotateCanvas(j),this.drawBitmap(c,-d,-e),this.restoreCanvasState()}createBitmap(c,d){let e=document.createElement("canvas");e.width=c,e.height=d;let f=e.getContext("2d");return{canvas:e,context:f,width:c,height:d}}createTintedBitmap(c,d){let e=this.createBitmap(c.width,c.height),f=e.context,h=this.getTargetCanvas();return this.setTargetCanvas(e.canvas),this.drawBitmap(c,0,0),this.setBlendMode("multiply"),this.drawFilledRectangle(0,0,e.width,e.height,d),this.setBlendMode("destination-atop"),this.drawBitmap(c,0,0),this.setTargetCanvas(h),e}createClippedBitmap(c,d,e,f,h){let j=c.context.getImageData(d,e,f,h),k=document.createElement("canvas"),l=k.getContext("2d");return k.width=f,k.height=h,l.putImageData(j,0,0),{canvas:k,context:l,width:f,height:h}}drawPolyline(c,d,e){this.setStrokeAndFillStyle(d,e);let f=[],h=[],j=0,k=c.length;for(j;j<k;++j)j%2?h.push(c[j]):f.push(c[j]);for(this.target_canvas.context.beginPath(),j=0,k=f.length,j;j<k;++j){if(0==j){this.target_canvas.context.moveTo(f[j],h[j]);continue}this.target_canvas.context.lineTo(f[j],h[j])}this.target_canvas.context.stroke()}drawPolygon(c,d,e){this.setStrokeAndFillStyle(d,e);let f=[],h=[],j=0,k=c.length;for(j;j<k;++j)j%2?h.push(c[j]):f.push(c[j]);for(this.target_canvas.context.beginPath(),j=0,k=f.length,j;j<k;++j){if(0==j){this.target_canvas.context.moveTo(f[j],h[j]);continue}this.target_canvas.context.lineTo(f[j],h[j])}this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledPolygon(c,d){this.setStrokeAndFillStyle(d);let e=[],f=[],h=0,j=c.length;for(h;h<j;++h)h%2?f.push(c[h]):e.push(c[h]);for(this.target_canvas.context.beginPath(),h=0,j=e.length,h;h<j;++h){if(0==h){this.target_canvas.context.moveTo(e[h],f[h]);continue}this.target_canvas.context.lineTo(e[h],f[h])}this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawLine(c,d,e,f,h,j){this.drawPolyline([c,d,e,f],h,j)}drawPixel(c,d,e){this.drawFilledRectangle(c,d,c+1,d+1,e)}drawArc(c,d,e,f,h,j,k){this.setStrokeAndFillStyle(j,k),this.target_canvas.context.beginPath(),this.target_canvas.context.arc(c,d,e,f,h),this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledArc(c,d,e,f,h,j){this.setStrokeAndFillStyle(j),this.target_canvas.context.beginPath(),this.target_canvas.context.arc(c,d,e,f,h),this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawCircle(c,d,e,f,h){this.drawArc(c,d,e,0,2*Math.PI,f,h)}drawFilledCircle(c,d,e,f){this.drawFilledArc(c,d,e,0,2*Math.PI,f)}drawEllipse(c,d,e,f,h,j){this.setStrokeAndFillStyle(h,j),this.target_canvas.context.beginPath(),this.target_canvas.context.ellipse(c,d,e,f,0,0,2*Math.PI),this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledEllipse(c,d,e,f,h){this.setStrokeAndFillStyle(h),this.target_canvas.context.beginPath(),this.target_canvas.context.ellipse(c,d,e,f,0,0,2*Math.PI),this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawRectangle(c,d,e,f,h,j){this.setStrokeAndFillStyle(h,j),this.target_canvas.context.beginPath(),this.target_canvas.context.rect(c,d,e-c,f-d),this.target_canvas.context.closePath(),this.target_canvas.context.stroke()}drawFilledRectangle(c,d,e,f,h){this.setStrokeAndFillStyle(h),this.target_canvas.context.beginPath(),this.target_canvas.context.rect(c,d,e-c,f-d),this.target_canvas.context.closePath(),this.target_canvas.context.fill()}drawTriangle(c,d,e,f,h,j,k,l){this.drawPolygon([c,d,e,f,h,j],k,l)}drawFilledTriangle(c,d,e,f,h,j,k){this.drawFilledPolygon([c,d,e,f,h,j],k)}};
